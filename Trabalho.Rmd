---
title: "Análise da Poluição do Ar com Dados do GBD"
author: "João Silva, Marco Pereira, Mariana Ribeiro"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: true
    number_sections: true
    citation_package: default
bibliography: referencias.bib
csl: apa7.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Resumo

Este trabalho analisa os impactos da poluição do ar na saúde pública utilizando 
dados do Global Burden of Disease (GBD)[@bennitt_global_nodate]. Através de técnicas de preparação e 
análise exploratória de dados (EDA), são identificadas tendências, padrões e 
potenciais problemas de qualidade nos dados.

# Introdução

A poluição do ar é um dos principais fatores de risco para doenças respiratórias 
e cardiovasculares. Este estudo visa explorar os dados do GBD para compreender 
melhor os efeitos da poluição do ar em diferentes países, faixas etárias e géneros.

# Metodologia

## Fonte de Dados

- Dados extraídos do GBD 2021
- Ferramenta utilizada: GBD Results Tool
- Link da pesquisa e ficheiro:
1990 + Global + SDI + Health System
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/4ea5715918446e5a6d9b154d62e0cc4a
IHME-GBD_2021_DATA-4835a3dc-1.csv
2000 + Global + SDI + Health System
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/64781d061f111ef4af5ad17974b6eb98
IHME-GBD_2021_DATA-c56a3848-1.csv
2010 + Global + SDI + Health System
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/88ae5e347d197231fa598e3dfc8e219a
IHME-GBD_2021_DATA-1923af35-1.csv
2020 + Global + SDI + Health System
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/2d070aac165f1d6a455d41df6c34e501
IHME-GBD_2021_DATA-d14075a8-1.csv
2021 + Global + SDI + Health System
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/3fad5e919cb9822381a5b56543978c2a
IHME-GBD_2021_DATA-840155c6-1.csv
1990 + Países todos + Age (all + standardized) + Sex (Both)
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/8dcef8a43426d16927c72f4d2a96147c
IHME-GBD_2021_DATA-7baf5a43-1.csv
2000 + Países todos + Age (all + standardized) + Sex (Both)
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/137d422bc7e27adb3442cd2a0c699368
IHME-GBD_2021_DATA-db69c1e8-1.csv
2010 + Países todos + Age (all + standardized) + Sex (Both)
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/be61825c6c4ec111b07e9d9847613cd0
IHME-GBD_2021_DATA-dcf93c30-1.csv
2020 + Países todos + Age (all + standardized) + Sex (Both)
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/972411dc3a931543fdecc15424db9019
IHME-GBD_2021_DATA-03b79351-1.csv
2021 + Países todos + Age (all + standardized) + Sex (Both)
https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/337e92e538d09c5d3d80640ee324032e
IHME-GBD_2021_DATA-ce582a59-1.csv

- Em termos de temas (features) temos:
        *Fatores de risco (poluição e subdivisões e tabagismo)
        *Causa (doenças respiratórias crónicas e suas subdivisões)
        *Sexo
        *Idade
        *Locais (regiões who, continentes (?), SDI e sistemas de saúde)
        *Anos (1990, 2000, 2010,2020 e 2021)

## Preparação dos Dados

- Seleção de colunas relevantes (e.g., país, ano, sexo, idade, medida, causa)
- Tratamento de dados faltantes e outliers
- Verificação de formatos e consistência

```{r,message=FALSE}
#install.packages("tidyverse")
library(tidyverse)
```

```{r}
#Importar os dados
gbd_data <- read.csv("IHME-GBD_2021_DATA-4835a3dc-1.csv")
gbd_data2 <- read.csv("IHME-GBD_2021_DATA-c56a3848-1.csv")
gbd_data3 <- read.csv("IHME-GBD_2021_DATA-1923af35-1.csv")
gbd_data4 <- read.csv("IHME-GBD_2021_DATA-d14075a8-1.csv")
gbd_data5 <- read.csv("IHME-GBD_2021_DATA-840155c6-1.csv")
gbd_data6 <- read.csv("IHME-GBD_2021_DATA-7baf5a43-1.csv")
gbd_data7 <- read.csv("IHME-GBD_2021_DATA-db69c1e8-1.csv")
gbd_data8 <- read.csv("IHME-GBD_2021_DATA-dcf93c30-1.csv")
gbd_data9 <- read.csv("IHME-GBD_2021_DATA-03b79351-1.csv")
gbd_data10 <- read.csv("IHME-GBD_2021_DATA-ce582a59-1.csv")
#Juntar as duas bases de dados
gbd_total <- bind_rows(gbd_data, gbd_data2,gbd_data3,gbd_data4,gbd_data5,gbd_data6,
                       gbd_data7,gbd_data8,gbd_data9,gbd_data10)
#Mudar para um formato mais tidy
gbd_total_wide <- gbd_total %>%
        pivot_wider(
                names_from = c(measure, metric),
                values_from = c(val, upper, lower),
                names_sep = "_",
                names_vary = "slowest"
  )
#Sumário dos dados
glimpse(gbd_total)
```
```{r}
# Converter colunas para fator
gbd_total <- gbd_total %>%
  mutate(across(c(measure, location, sex, age, cause, rei, metric), as.factor))
```



```{r}
names(gbd_total)
```

```{r}
# Devolve um vetor com todos os valores únicos (os nomes das categorias)
measure_classes <- unique(gbd_total$measure)
print(measure_classes)
```

```{r}
location_classes <- unique(gbd_total$location)
print(location_classes)
```

```{r}
cause_classes <- unique(gbd_total$cause)
print(cause_classes)
```

```{r}
rei_classes <- unique(gbd_total$rei)
print(rei_classes)
```

```{r}
metric_classes <- unique(gbd_total$metric)
print(metric_classes)
```

```{r}
age_classes <- unique(gbd_total$age)
print(age_classes)
```


## Ferramentas

- Linguagem: R
- Ambiente: RStudio
- Pacotes: `tidyverse`, `ggplot2`, `dplyr`, `readr`, `knitr`, `rmarkdown`

# Análise Exploratória dos Dados (EDA)

```{r,message=FALSE,warning=FALSE}
library(ggplot2)
library(forcats)
```


## 1. Impacto Geral da Poluição do Ar

## 2. Doenças Respiratórias Específicas

## 3. Tendências Temporais

## 4. Disparidades Regionais e Sociais

### Quais regiões têm maior carga de doenças respiratórias atribuíveis à poluição do ar?

```{r}
# Filtrar apenas linhas com metric == "Rate" e measure == "Deaths"
gbd_filtered <- subset(gbd_total, measure == "Deaths" & sex == "Both" & 
        age == "Age-standardized" & cause == "Chronic respiratory diseases" & 
        rei == "Air pollution" & metric == "Rate" & year == "2021")
# Ordenar as regiões por valor
gbd_filtered<-mutate(gbd_filtered,location = fct_reorder(location, val))
# Fazer Barplot
ggplot(data = gbd_filtered, aes(x = location, y = val)) +
        geom_bar(stat = "identity", width = 0.6, fill = "steelblue") +
        geom_errorbar( aes(x=location, ymin=lower, ymax=upper), 
                width=0.4, colour="orange", alpha=0.9, size=0.5) + 
        coord_flip() +
        labs(title = "Taxa de Mortes por Doenças respiratórias por Local",
                x = "Local", y = "Taxa") +
        theme_minimal()
```
```{r}
# Filtrar apenas linhas com metric == "Rate" e measure == "Deaths"
gbd_filtered <- subset(gbd_total, measure == "YLDs (Years Lived with Disability)" & sex == "Both" & 
        age == "Age-standardized" & cause == "Chronic respiratory diseases" & 
        rei == "Air pollution" & metric == "Rate" & year == "2021")
# Ordenar as regiões por valor
gbd_filtered<-mutate(gbd_filtered,location = fct_reorder(location, val))
# Fazer Barplot
ggplot(data = gbd_filtered, aes(x = location, y = val)) +
        geom_bar(stat = "identity", width = 0.6, fill = "steelblue") +
        geom_errorbar( aes(x=location, ymin=lower, ymax=upper), 
                width=0.4, colour="orange", alpha=0.9, size=0.5) + 
        coord_flip() +
        labs(title = "Taxa de Mortes por Doenças respiratórias por Local",
                x = "Local", y = "Taxa") +
        theme_minimal()
```

### Existe correlação entre o Índice Sociodemográfico (SDI) e a carga de doença?

```{r}
# Filtrar apenas linhas com metric == "Rate" e measure == "Deaths"
gbd_filtered <- subset(gbd_total, measure == "Deaths" & 
        location %in% c("Low SDI","Low-middle SDI","Middle SDI","High-middle SDI","High SDI") & 
        sex == "Both" & age == "Age-standardized" & cause == "All causes" & 
        rei == "Air pollution" & metric == "Rate" & year == "2021")
# Fazer Barplot
ggplot(data = gbd_filtered, aes(x = location, y = val)) +
        geom_bar(stat = "identity", width = 0.6, fill = "steelblue") +
        geom_errorbar( aes(x=location, ymin=lower, ymax=upper), 
                width=0.4, colour="orange", alpha=0.9, size=0.5) + 
        coord_flip() +
        labs(title = "Taxa de Mortes por SDI",
                x = "Local", y = "Taxa") +
        theme_minimal()
```

### Como variam os impactos por sexo (boxplot/violinplot) e faixa etária (barras/histograma)?

```{r}
# Filtrar apenas linhas com metric == "Rate" e measure == "Deaths"
gbd_filtered <- subset(gbd_total, measure == "Deaths" & 
        location == "Global" & 
        sex == "Both" & 
        !age %in% c("All ages", "7-27 days", "Age-standardized") &
        cause == "All causes" & 
        rei == "Air pollution" & 
        metric == "Rate" & 
        year == "2021")
# Fazer Barplot
ggplot(data = gbd_filtered, aes(x = age, y = val)) +
        geom_bar(stat = "identity", width = 0.6, fill = "steelblue") +
        geom_errorbar( aes(x=age, ymin=lower, ymax=upper), 
                width=0.4, colour="orange", alpha=0.9, size=0.5) + 
        labs(title = "Taxa de Mortes por SDI",
                x = "Local", y = "Taxa") +
        theme_minimal()
```

```{r}
# Filtrar apenas linhas com metric == "Rate" e measure == "Deaths"
gbd_filtered <- subset(gbd_total, measure == "Deaths" & 
        location == "Global" & 
        sex %in% c("Male", "Female") &
        !age %in% c("All ages", "7-27 days", "Age-standardized") &
        cause == "All causes" & 
        rei == "Air pollution" & 
        metric == "Rate" & 
        year == "2021")
# Fazer Barplot
ggplot(data = gbd_filtered, aes(x = age, y = val, fill = sex)) +  # Adicionado fill = sex para agrupamento
        geom_bar(stat = "identity", width = 0.6, position = position_dodge(width = 0.6)) +  # position_dodge para barras lado a lado
        geom_errorbar(aes(ymin = lower, ymax = upper), 
                position = position_dodge(width = 0.6),  # Alinhar barras de erro com as barras dodged
                width = 0.4, colour = "orange", alpha = 0.9, size = 0.5) + 
        labs(title = "Taxa de Mortes por Idade e Sexo (Poluição do Ar, Global, 2021)",
                x = "Idade", y = "Taxa", fill = "Sexo") +
        theme_minimal() +
        theme(legend.position = "right")
```

# Discussão

*Interpretação dos resultados
*Comparação com fontes externas (e.g., WHO, dados governamentais)
*Limitações dos dados e da análise

# Conclusão

*Principais conclusões sobre o impacto da poluição do ar
*Sugestões para futuras investigações

# Referências



# Anexos


