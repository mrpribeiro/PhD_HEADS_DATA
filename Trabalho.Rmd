---
title: "Impact of Air Pollution on Chronic Respiratoy Diseases: An Exploratory Data Analysis of GBD Data"
authors: "João Silva, Marco Pereira, Mariana Ribeiro"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true
    citation_package: default
bibliography: referencias.bib
csl: apa7.csl
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message=FALSE, warning=FALSE, cache=TRUE, fig.width=10, fig.height=6)
```

# Abstract

This study investigates the global impact of air pollution on chronic
respiratory diseases (CRDs) using data from the Global Burden of Disease
(GBD) 2021. Through exploratory data analysis, we examine the
contribution of different types of air pollutants—ambient particulate
matter, household air pollution, ozone, and nitrogen dioxide—to
CRD-related mortality and disability. In 2021, CRDs accounted for 22.1%
of all deaths and 29.4% of all years lived with disability (YLDs)
attributable to air pollution. The burden is disproportionately higher
in countries with low and low-middle Socio-demographic Index (SDI), and
in regions with limited or minimal health system capacity. While
mortality rates have declined over time, the chronic health impact
remains significant, with a shift toward long-term disability. The
findings highlight the urgent need for targeted interventions and policy
measures to mitigate air pollution and reduce its health burden,
especially in vulnerable populations.

# Introduction

Air pollution is one of the leading environmental risk factors for
public health worldwide. It can be broadly categorized into ambient
(outdoor) air pollution, which originates from sources such as traffic
emissions, industrial activities, forest fires, and energy production,
and household (indoor) air pollution, which is prevalent in rural areas
of low-income countries due to the burning of solid fuels like wood,
dung, and crop residues for cooking and heating [@dhimal_impact_2021].
Both forms of air pollution are strongly associated with chronic
respiratory diseases (CRDs), including chronic obstructive pulmonary
disease (COPD) and asthma, as well as other serious health conditions
such as lower respiratory infections, cardiovascular diseases, diabetes,
and adverse birth outcomes. It is estimated that around 3.6 billion
people are exposed to household air pollution, highlighting the global
scale of the issue [@dhimal_impact_2021]. This study aims to analyze the
impact of air pollution on CRDs using data from the Global Burden of
Disease (GBD) project. Through exploratory data analysis (EDA), we
identify patterns, trends, and disparities across countries, age groups,
and genders. The goal is to deepen our understanding of how air
pollution affects respiratory health and to support the development of
more effective public health interventions.

# Methodology

This study employs an exploratory data analysis (EDA) approach to
investigate the global burden of chronic respiratory diseases (CRDs)
attributable to air pollution. Data were sourced from the Global Burden
of Disease (GBD) 2021 dataset, accessed via the GBD Results Tool. The
dataset includes metrics such as deaths, DALYs (Disability-Adjusted Life
Years), YLLs (Years of Life Lost), and YLDs (Years Lived with
Disability), stratified by age, sex, location, health system type, and
socio-demographic index (SDI). The analysis focuses on key risk factors
including ambient particulate matter pollution, household air pollution
from solid fuels, ambient ozone pollution, and nitrogen dioxide
pollution. Data preparation involved selecting relevant columns, and
ensuring consistency across formats. The analysis was conducted using R,
allowing for efficient data manipulation and visualization. Temporal
trends, geographical distribution, and disparities across SDI classes
and health system types were examined to provide a comprehensive view of
the impact of air pollution on CRDs.

```{r}
#install.packages(c("tidyverse", "scales", "rnaturalearth", "rnaturalearthdata", "sf", "countrycode", "viridis","patchwork"))

# Load necessary libraries
library(tidyverse) #Já inclui dplyr + ggplot2 + forcat etc...
library(scales)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
library(countrycode)
library(viridis)
library(patchwork)
library(purrr)
#Remove everything, clean environment
rm(list = ls())
```

```{r}
#Importar os dados
gbd_data <- read.csv("IHME-GBD_2021_DATA-4835a3dc-1.csv")
gbd_data2 <- read.csv("IHME-GBD_2021_DATA-c56a3848-1.csv")
gbd_data3 <- read.csv("IHME-GBD_2021_DATA-1923af35-1.csv")
gbd_data4 <- read.csv("IHME-GBD_2021_DATA-d14075a8-1.csv")
gbd_data5 <- read.csv("IHME-GBD_2021_DATA-840155c6-1.csv")
gbd_data6 <- read.csv("IHME-GBD_2021_DATA-7baf5a43-1.csv")
gbd_data7 <- read.csv("IHME-GBD_2021_DATA-db69c1e8-1.csv")
gbd_data8 <- read.csv("IHME-GBD_2021_DATA-dcf93c30-1.csv")
gbd_data9 <- read.csv("IHME-GBD_2021_DATA-03b79351-1.csv")
gbd_data10 <- read.csv("IHME-GBD_2021_DATA-ce582a59-1.csv")
gbd_data11 <- read.csv("IHME-GBD_2021_DATA-382c4db5-1.csv")
#Juntar as bases de dados
gbd_total <- bind_rows(gbd_data, gbd_data2,gbd_data3,gbd_data4,gbd_data5,gbd_data6,
        gbd_data7,gbd_data8,gbd_data9,gbd_data10,gbd_data11)
```

```{r, results='hide'}
#Sumário dos dados
glimpse(gbd_total)
```

```{r}
#library(dlookr)
#gbd_total %>%
  #diagnose_paged_report(output_format = "html", output_file = "Diagn.html")
#Paged dá para escolher pdf se for web não dá
```

```{r}
# Converter colunas para factor
gbd_total <- gbd_total %>%
        mutate(across(c(measure, location, sex, age, cause, rei, metric), as.factor))
```

```{r, results='hide'}
names(gbd_total)
```

```{r,results='asis'}
# Devolve um vetor com todos os valores únicos (os nomes das categorias)
measure_classes <- unique(gbd_total$measure)
location_classes <- unique(gbd_total$location)
sex_classes <- unique(gbd_total$sex)
age_classes <- unique(gbd_total$age)
cause_classes <- unique(gbd_total$cause)
rei_classes <- unique(gbd_total$rei)
metric_classes <- unique(gbd_total$metric)
year_classes <- unique(gbd_total$year)
# Criar uma lista com todas as variáveis
classes_list <- list(
        measure = measure_classes,
        location = location_classes,
        sex = sex_classes,
        age = age_classes,
        cause = cause_classes,
        rei = rei_classes,
        metric = metric_classes,
        year = year_classes
)
# Criar data frame para tabela
df_vars <- tibble::tibble(
  Variable = names(classes_list),
  Values = purrr::map_chr(classes_list, ~ paste(.x, collapse = ", "))
)

# Imprimir como tabela Markdown
knitr::kable(df_vars, format = "markdown", align = "l")
```

```{r,results='asis'}
# Função para formatar cada categoria
format_line <- function(name, values) {
  paste0("**", name, ":** ", paste(values, collapse = ", "), "  \n")
}

# Aplicar a função à lista
markdown_text <- purrr::map2(names(classes_list), classes_list, format_line) %>%
  paste(collapse = "")

# Imprimir no formato Markdown
cat(markdown_text)
```

# Results

```{r}
# Custom palette: worse -> better
pal <- c(
        "High SDI" = "#1a9850",
        "High-middle SDI" = "#fee08b",
        "Middle SDI" = "#fed976",
        "Low-middle SDI" = "#fdae61",
        "Low SDI" = "#b2182b",
        "Minimal Health System"   = "#b2182b",
        "Limited Health System"   = "#fdae61",
        "Basic Health System"     = "#fee08b",
        "Advanced Health System"  = "#1a9850"
        )
# Define the SDI categories
SDI_regions <- c(
        "Low SDI",
        "Low-middle SDI",
        "Middle SDI",
        "High-middle SDI",
        "High SDI"
        )
# Define the health system categories
health_systems <- c("Advanced Health System",
                    "Basic Health System",
                    "Limited Health System",
                    "Minimal Health System")
# Define countries
countries <- gbd_data10$location
# Define country super regions
country_regions <- gbd_data11$location
geral_theme <- theme_minimal(base_size = 12) +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 12, face = "bold"),
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    axis.text = element_text(size = 10)
  )
```

## Impact of different types of polluents

```{r}
df_types <- gbd_total %>%
        filter(
                measure =="DALYs (Disability-Adjusted Life Years)",
                cause == "Chronic respiratory diseases",
                rei %in% c("Ambient particulate matter pollution", 
                           "Household air pollution from solid fuels",
                           "Nitrogen dioxide pollution",
                           "Ambient ozone pollution"),
                metric == "Rate",     
                location == "Global",
                age == "All ages",
                sex == "Both"
        )
# Ordenar tipos de poluição para apresentação consistente
df_types$rei <- factor(df_types$rei,
        levels = c("Household air pollution from solid fuels",
                "Ambient particulate matter pollution",
                "Nitrogen dioxide pollution",
                "Ambient ozone pollution"
        ))
# Nova paleta para tipos de poluição
pal_pollution <- c(
        "Ambient particulate matter pollution" = "#fdae61",
        "Household air pollution from solid fuels" =  "#b2182b" ,
        "Nitrogen dioxide pollution" = "#2b83ba",
        "Ambient ozone pollution" = "#66c2a5"
        )
# Plot
df_types %>% 
        ggplot(aes(x = rei, y = val, fill = rei)) +
        geom_col(color = "black", width = 0.7) +
        geom_errorbar(
                aes(ymin = lower, ymax = upper), 
                width = 0.18, 
                size = 0.6, 
                color = "black"
        ) +
        geom_text(
                aes(label = round(val, 0)), 
                hjust = -1, 
                vjust = -0.9,
                size = 4) +
        scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
        scale_fill_manual(values = pal_pollution, name = "Type of pollution") +
        facet_grid(measure ~ cause, scales = "free_y") +
        coord_flip() +
        labs(
                title = "Global Impact of Different Types of Air Pollution on CRD (2021)",
                subtitle = "DALYs per 100,000 population",
                x = "",
                y = "Rate per 100,000",
                caption = "Data source: GBD 2021"
        ) +
        geral_theme
```

## Impact on different Socio-demographic Index

### Percentage of Household Air Pollution contribution on particulate matter pollution

```{r}
# Filter and summarise for Rate:
df_SDI2 <- gbd_total %>%
        filter(
                location %in% SDI_regions,
                rei %in% c("Household air pollution from solid fuels",
                        "Ambient particulate matter pollution"),
                metric == "Rate",     
                cause == "Chronic respiratory diseases",
                age == "Age-standardized",
                sex == "Both"
        ) %>%
        select(measure, location, val, rei)
# Calcular proporção de Household / (Ambient + Household)
df_prop <- df_SDI2 %>%
        filter(rei %in% c("Ambient particulate matter pollution",
                "Household air pollution from solid fuels")) %>%
        group_by(location, measure) %>%
        summarise(
                ambient = sum(val[rei == "Ambient particulate matter pollution"], na.rm = TRUE),
                household = sum(val[rei == "Household air pollution from solid fuels"], na.rm = TRUE)
        ) %>%
        mutate(proportion_household = household / (ambient + household))
# Make sure your health_systems are ordered in the plot
df_prop <- df_prop %>%
        mutate(location = factor(location, levels = c(
                "Low SDI",
                "Low-middle SDI",
                "Middle SDI",
                "High-middle SDI",
                "High SDI"
        )))
# Ordered measure
df_prop$measure <- factor(df_prop$measure,
        levels = c(
                "Deaths",
                "DALYs (Disability-Adjusted Life Years)",
                "YLLs (Years of Life Lost)",
                "YLDs (Years Lived with Disability)"
        ))
# Plot
df_prop %>% 
        ggplot(aes(x = location, y = proportion_household, fill = location)) +
        geom_col(color = "black", width = 0.7) +
        geom_text(
                aes(label = scales::percent(proportion_household, accuracy = 1)),
                hjust = -0.2, 
                size = 4
        ) +
        scale_fill_manual(values = pal) +
        scale_y_continuous(
                labels = percent_format(accuracy = 1), 
                limits = c(0, 1.05)
        ) +
        facet_wrap(~ measure, scales = "free_x") +
        coord_flip() +
        labs(
                title = "Percentage of Household Air Pollution contribution on particulate matter pollution",
                subtitle = "By SDI classes (2021)",
                x = "",
                y = "",
                caption = "Source: GBD 2021"
        ) +
        geral_theme
```

### Impact of Particulate Matter Pollution by SDI Classes (2021)

```{r}
# Filter and summarise for Rate:
df_SDI_regions <- gbd_total %>%
        filter(
                location %in% SDI_regions,
                rei == "Air pollution",
                metric == "Rate",
                cause == "Chronic respiratory diseases",
                age == "Age-standardized",
                sex == "Both"
        ) %>%
        select(measure, location, val, upper, lower)
# Make sure SDI regions are ordered in the plot
df_SDI_regions <- df_SDI_regions %>%
        mutate(location = factor(location, levels = c(
                "Low SDI",
                "Low-middle SDI",
                "Middle SDI",
                "High-middle SDI",
                "High SDI"
        )))
# Ordered measure
df_SDI_regions$measure <- factor(df_SDI_regions$measure,levels = c(
        "Deaths",
        "DALYs (Disability-Adjusted Life Years)",
        "YLLs (Years of Life Lost)",
        "YLDs (Years Lived with Disability)"
        ))
# Plot
df_SDI_regions %>% 
        ggplot(aes(x = location, y = val, fill = location)) +
        geom_col(color = "black", width = 0.7) +
        geom_errorbar(
                aes(ymin = lower, ymax = upper), 
                width = 0.18, 
                size = 0.6, 
                color = "black") +
        geom_text(
                aes(label = round(val, 0)), 
                hjust = -0.1, 
                vjust = -0.4,
                size = 4
        ) +
        scale_fill_manual(values = pal) +
        scale_y_continuous() +
        facet_wrap(~ measure, scales = "free_x") +
        coord_flip() +
        labs(
                title = "Impact of Particulate Matter Pollution by SDI Classes (2021)",
                subtitle = "Deaths, DALYs, YLLs & YLDS (per 100,000 population) with 95% uncertainty intervals",
                x = "",
                y = "Rate per 100,000",
                caption = "Data Source: GBD 2021"
        ) +
        theme_minimal(base_size = 13) +
        theme(
                legend.position = "none",
                strip.text = element_text(face = "bold", size = 20),
                plot.title = element_text(face = "bold", size = 24),
                plot.subtitle = element_text(size = 16),
                axis.title.x = element_text(size = 18, face = "bold"),  # y-axis title (since coord_flip)
                axis.title.y = element_text(size = 18, face = "bold"),  # x-axis title
                axis.text.x  = element_text(size = 14),                 # tick labels (x-axis)
                axis.text.y  = element_text(size = 14)                  # tick labels (y-axis)
        )
```

## DALYs attributable to household vs ambient particulate air pollution worldwide (1990–2021)

```{r}
# Preparar os dados
global_DALYS_year <- gbd_total %>%
        filter(
                measure == "DALYs (Disability-Adjusted Life Years)",
                location == "Global",
                rei %in% c("Household air pollution from solid fuels","Ambient particulate matter pollution"),
                metric == "Number",
                cause == "Chronic respiratory diseases",
                age == "All ages",
                sex == "Both"
        ) %>%
        select(rei, year, val, upper, lower)
# Plot
global_DALYS_year %>%
        ggplot(aes(x = year, y = val, color = rei, fill = rei, group = rei)) +
        geom_ribbon(
                aes(ymin = lower, ymax = upper), 
                alpha = 0.2, 
                color = NA) +
        geom_line(size = 1.2) +
        scale_color_manual(values = c(
                "Ambient particulate matter pollution" = "#fdae61",
                "Household air pollution from solid fuels" = "#b2182b"
        )) +
        scale_fill_manual(values = c(
                "Ambient particulate matter pollution" = "#fdae61",
                "Household air pollution from solid fuels" = "#b2182b"
        )) +
        geom_point(size = 2) +
        labs(
                title = "DALYs attributable to particulate air pollution worldwide (1990–2021)",
                x = "Year",
                y = "DALYs (Number)",
                color = NULL,
                fill = NULL,
                caption = "Data Source: Global Burden of Disease 2021"
        ) +
        theme_minimal() +
        theme(
                axis.title.x = element_text(size = 18),
                axis.title.y = element_text(size = 18),
                plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
                plot.subtitle = element_text(size = 14, hjust = 0.5),
                legend.title = element_text(size = 18),
                legend.text = element_text(size = 18)
        )
```

## Geographical distribution

### Global health impact of air pollution on chronic respiratory diseases from 1990 to 2021

Between 1990 and 2021, global mortality rates from CRDs attributable to
air pollution showed marked geographical variation and a general decline
over time (Figure X-MAPS). In 1990, the highest mortality rates were
concentrated in East and South Asia, particularly in China and India, as
well as parts of Sub-Saharan Africa and northern Oceania. By 2021,
although these regions remained among the most affected, the intensity
of mortality had visibly decreased, as indicated by the lighter color
gradients on the map.

```{r}
# Filter and select relevant columns for deaths in 2021
df_deaths_clean_2021 <- gbd_total %>%
        filter(
                measure == "Deaths",
                location %in% countries,
                sex == "Both",
                age == "Age-standardized",
                cause == "Chronic respiratory diseases",
                rei == "Air pollution",
                metric == "Rate",
                year == "2021"
        ) %>%
        select(location, val, upper, lower)

# Filter and select relevant columns for deaths in 1990
df_deaths_clean_1990 <- gbd_total %>%
        filter(
                measure == "Deaths",
                location %in% countries,
                sex == "Both",
                age == "Age-standardized",
                cause == "Chronic respiratory diseases",
                rei == "Air pollution",
                metric == "Rate",
                year == "1990"
        ) %>%
        select(location, val, upper, lower)

# Load world map
world <- ne_countries(scale = "medium", returnclass = "sf")

# Standardize country names using countrycode
## First, create ISO3 codes for GBD data
### 2021
df_deaths_clean_2021$iso3 <- countrycode(df_deaths_clean_2021$location,
                                        origin = "country.name",
                                        destination = "iso3c")
### 1990
df_deaths_clean_1990$iso3 <- countrycode(df_deaths_clean_1990$location,
                                         origin = "country.name",
                                         destination = "iso3c")
## Create ISO3 codes for world map
world$iso3 <- countrycode(world$name,
                          origin = "country.name",
                          destination = "iso3c")

## Check unmatched countries
unmatched <- df_deaths_clean_2021 %>%
        filter(!iso3 %in% world$iso3) %>% # Keep all countries whose ISO3 code is not in the world dataset.
        select(location, iso3)
#unmatched$location
### The non correlation with the iso3 code is from the world dataset (because df does not have Null values associated)

## Fix known mismatches manually
world$name[world$name == "Micronesia"] <- "Micronesia (Federated States of)"
world$name[world$name == "St. Vin. and Gren."] <- "Saint Vincent and the Grenadines"
world$name[world$name == "U.S. Virgin Is."] <- "United States Virgin Islands "
world$name[world$name == "S. Sudan"] <- "South Sudan "
### Tokelau cannot be matched

## Recalculate ISO3 codes after fixing names
world$iso3 <- countrycode(world$name,
                          origin = "country.name",
                          destination = "iso3c")

## Check unmatched countries again
unmatched <- df_deaths_clean_2021 %>%
        filter(!iso3 %in% world$iso3) %>%
        select(location)
#unmatched$location

# Merge GBD data with world map
world_data_2021 <- world %>%
        left_join(df_deaths_clean_2021, by = "iso3")
world_data_1990 <- world %>%
        left_join(df_deaths_clean_1990, by = "iso3")

# Determine the common range across both datasets
fill_limits <- range(c(world_data_1990$val, world_data_2021$val), na.rm = TRUE)


# Common theme to make maps consistent
base_theme <- theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank()
  )

# Plot for deaths 1990 (no legend, simple title)
p1990 <- ggplot(data = world_data_1990) +
  geom_sf(aes(fill = val), color = "grey40", size = 0.1) +
  scale_fill_viridis_c(
    option = "inferno", na.value = "lightgrey",
    direction = -1, name = "Deaths/100k", limits = fill_limits
  ) +
  labs(title = "1990") +
  base_theme +
  theme(legend.position = "none")  # remove legend

# Plot for deaths 2021 (keep legend)
p2021 <- ggplot(data = world_data_2021) +
  geom_sf(aes(fill = val), color = "grey40", size = 0.1) +
  scale_fill_viridis_c(
    option = "inferno", na.value = "lightgrey",
    direction = -1, name = "Deaths/100k", limits = fill_limits
  ) +
  labs(title = "2021") +
  base_theme

# Combine maps side by side
combined_maps <- p1990 + p2021 +
  plot_annotation(
    title = "Global Deaths from Chronic Respiratory Diseases Attributable to Air Pollution (1990–2021)",
    subtitle = "Death Rates per 100,000 Population",
    caption = "Data Source: Global Burden of Disease 2021"
  ) &
  theme(
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5)
  )

# Show maps
combined_maps
```

Figure X-TOPs further illustrates these changes at the country level. In
1990, China had one of the highest mortality rates (160\> deaths per
100,000), but by 2021, it showed a substantial reduction, no longer
ranking among the top 10 (\<40 deaths per 100,000). Nepal, however,
emerged as the country with the highest mortality rate in 2021, despite
a slight decrease over time. Other high-burden countries in 2021
included Papua New Guinea, India, Bangladesh, and Myanmar, reflecting
the continued concentration of risk in South and East Asia.

```{r}
# Top 10 highest death rate countries
top10_high_2021 <- df_deaths_clean_2021 %>%
  arrange(desc(val)) %>%
  slice_head(n = 10)

top10_high_1990 <- df_deaths_clean_1990 %>%
  arrange(desc(val)) %>%
  slice_head(n = 10)

# Top 10 lowest death rate countries
top10_low_2021 <- df_deaths_clean_2021 %>%
  arrange(val) %>%
  slice_head(n = 10)

top10_low_1990 <- df_deaths_clean_1990 %>%
  arrange(val) %>%
  slice_head(n = 10)

# Combine both years into one table
# Highest
top10_high_table <- bind_rows(
  top10_high_2021 %>% mutate(year = "2021"),
  top10_high_1990 %>% mutate(year = "1990")
) %>%
  select(year, location, val, upper, lower)
# Lowest
top10_low_table <- bind_rows(
  top10_low_2021 %>% mutate(year = "2021"),
  top10_low_1990 %>% mutate(year = "1990")
) %>%
  select(year, location, val, upper, lower)

# Make sure year is a factor so colors are consistent
top10_high_table$year <- factor(top10_high_table$year, levels = c("1990", "2021"))
top10_low_table$year <- factor(top10_low_table$year, levels = c("1990", "2021"))

# Lolipop Plots 
# Define color mapping
year_colors <- c("1990" = "#003f5c", "2021" = "#ffa600")

# Base theme
base_theme <- theme_minimal() +
  theme(
    plot.title = element_text(size = 11, face = "bold", hjust = 0.5),
    axis.title.y = element_blank(),
    axis.title.x = element_text(size = 11),
    axis.text.y = element_text(size = 11, face = "bold"),
    axis.text.x = element_text(size = 10),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 11)
  )

# Lollipop HIGH
p_high <- ggplot(top10_high_table, aes(x = reorder(location, val), y = val, color = year)) +
  geom_segment(aes(xend = location, y = 0, yend = val), linewidth = 1) +
  geom_point(size = 4) +
  coord_flip() +
  scale_color_manual(values = year_colors, name = "Year") +
  labs(
    y = "Deaths/100k",
    title = "Highest Mortality Countries"
  ) +
  base_theme +
  theme(
    legend.position = "none"
  )

# Lollipop LOW
p_low <- ggplot(top10_low_table, aes(x = reorder(location, -val), y = val, color = year)) +
  geom_segment(aes(xend = location, y = 0, yend = val), linewidth = 1) +
  geom_point(size = 4) +
  coord_flip() +
  scale_color_manual(values = year_colors, name = "Year") +
  labs(
    y = "Deaths/100k",
    title = "Lowest Mortality Countries"
  ) +
  base_theme +
  theme(
    legend.position = "bottom",
    legend.justification = "center"
  )

# Combine side by side
combined_lolipops <- p_high + p_low +
  plot_layout(guides = "collect") +
  plot_annotation(
    title = "Global Extremes in Deaths from Air Pollution–Related Chronic Respiratory Diseases (1990 vs 2021)",
    caption = "Data source: Global Burden of Disease 2021"
  ) &
  theme(
    legend.position = "right",
    legend.direction = "vertical",
    legend.box.just = "center", 
    legend.title = element_text(size = 12, face = "bold"),
    legend.text = element_text(size = 11),
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5, margin = margin(b = 10)),
    plot.caption = element_text(size = 10, hjust = 1, face = "italic")
  )

# Show plot
combined_lolipops

# # CHINA values in 1990 and 2021
# df_deaths_clean_1990 %>%
# filter(
#   location == "China"
# )
# df_deaths_clean_2021 %>%
# filter(
#   location == "China"
# )


```

Conversely, countries with the lowest mortality rates (\<2 deaths per
100,000) in both years were predominantly high-income nations such as
Finland, Sweden, New Zealand, and Australia, along with several
Caribbean and Pacific island states.

Overall, the data suggest a global improvement in air pollution-related
CRD mortality, with significant progress in some high-burden countries
like China, while others, particularly in South Asia, showed limited
change.

There is a clear unequal burden of air pollution-related health
outcomes, likely driven by differences in industrialization, urban air
quality, healthcare infrastructure, and policy enforcement. While some
high-burden countries like China showed significant improvement over
time, others, particularly in South Asia experienced only modest
reductions, underscoring the need for targeted interventions in
vulnerable regions.

### Country ranking by all measures in 2021

```{r,warning=FALSE}
# Filtrar linhas
gbd_filtered <- gbd_total %>% 
        filter(
                location %in% gbd_data11$location,
                sex == "Both",
                age == "Age-standardized",
                cause == "Chronic respiratory diseases",
                rei == "Air pollution",
                metric == "Rate",
                year == "2021",
        )
# Obter os top 10 locais com mais mortes
top_locations <- gbd_filtered %>%
  filter(measure == "Deaths") %>%
  arrange(desc(val)) %>%
  mutate(rank = row_number()) %>%
  slice(1:10) %>%
  pull(location)
# Adicionar coluna de rank por medida e ordenar
gbd_filtered <- gbd_filtered %>%
        group_by(measure) %>%
        mutate(
                rank = rank(-val, ties.method = "first"),
                rank = if_else(rank <= 10, rank, NA_integer_),
                location = fct_reorder(location, desc(val))
        ) %>%
        ungroup()
# Fazer Barplot
gbd_filtered %>%
        ggplot(aes(x = location, y = val,color = measure, group = measure)) +
        geom_line(
                size = 1,
                alpha = 0.5,
        ) +
        geom_point(
                size = 3,
                alpha = 0.5,
        ) +
        geom_text(
                aes(x = location, y = val, label = rank), 
                vjust = -1.5, 
                size = 3, 
                fontface = "bold", 
                inherit.aes = FALSE) +
        labs(
                title = "Chronic Respiratory Disease Burden by Region (2021)",
                x = "Regions (ordered by decreasing number of deaths)",
                y = "Measure (rate)",
                color = "Measure",
                caption = "Data source: GBD 2021"
        ) +
        geral_theme +
        theme(
                axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
        )
```

## Impact of air pollution on chronic respiratory disease by health system type in 2021

Figure X-HS shows how the burden of CRDs caused by air pollution varies
depending on the strength of a country’s health system. As expected,
countries with strong, advanced health systems (green) show the lowest
rates of deaths and disease burden. However, the pattern across weaker
systems is not linear. Surprisingly, countries with basic health systems
report higher rates than those with limited or even minimal systems.

```{r}
# Prepare data
df_healthsystems <- gbd_data %>%
  filter(
    location %in% health_systems,
    rei == "Air pollution",
    metric == "Rate",
    cause == "Chronic respiratory diseases",
    age == "Age-standardized",
    sex == "Both"
  ) %>%
  select(measure, location, val, upper, lower) %>%
  mutate(location = factor(location, levels = c(
    "Minimal Health System",
    "Limited Health System",
    "Basic Health System",
    "Advanced Health System"
  )))

# Flexible plotting function
make_plot <- function(data, measure_label, x_label) {
  data %>%
    filter(measure == measure_label) %>%
    ggplot(aes(y = location, x = val, fill = location)) +
    geom_col(color = "black", width = 0.7) +
    geom_errorbar(aes(xmin = lower, xmax = upper),
                  width = 0.3, size = 0.6, color = "black") +
    scale_fill_manual(values = pal) +
    labs(
      title = measure_label,
      y = NULL,
      x = x_label
    ) +
    theme_minimal(base_size = 10) +
    theme(
      plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
      legend.position = "none",
      axis.text.y = element_text(size = 10, face = "bold"),
      axis.text.x = element_text(size = 10)
    )
}

# Individual plots
p_deaths <- make_plot(df_healthsystems,
                      "Deaths",
                      "Deaths/100k")

p_dalys  <- make_plot(df_healthsystems,
                      "DALYs (Disability-Adjusted Life Years)",
                      "DALYs/100k")

p_ylls   <- make_plot(df_healthsystems,
                      "YLLs (Years of Life Lost)",
                      "YLLs/100k")

p_ylds   <- make_plot(df_healthsystems,
                      "YLDs (Years Lived with Disability)",
                      "YLDs/100k")

# Combine into a 2×2 grid
combined_health <- (p_deaths | p_dalys) /
  (p_ylls | p_ylds) +
  plot_annotation(
    title = "Impact of Air Pollution on Chronic Respiratory Diseases by Health System Type (2021)",
    caption = "Data Source: Global Burden of Disease 2021",
    theme = theme(
      plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
      plot.caption = element_text(size = 8, face = "italic", hjust = 1)
    )
  )

# Show final figure
combined_health
```

This unexpected trend is likely explained by differences in diagnostic
capacity and data reporting. In countries with minimal health systems,
many cases go undiagnosed or unrecorded due to poor access to healthcare
and weak surveillance systems. As a result, the actual burden may be
much higher than what is reflected in the data. In contrast, basic
systems may have just enough infrastructure to detect and report more
cases, which can make their rates appear higher, not necessarily because
the situation is worse, but because it is better documented.

From Figure X-HS, it is also clear that most of the burden comes from
premature deaths, measured as YLLs, rather than long-term disability
(YLDs). This suggests that weaker health systems struggle to prevent or
treat pollution-related respiratory diseases effectively.

Overall, the figure highlights a clear inequality. People living in
countries with weaker healthcare systems face a much greater impact from
air pollution, especially in terms of early death. This pattern is
closely tied to income level, as low-income countries are more likely to
have minimal or limited health systems, while high-income countries tend
to have advanced ones. This reinforces the need for stronger health
infrastructure and pollution control policies.

## Temporal trends attributable to air pollution on chronical respiratory diseases between 1990 and 2021

Figure X-GlobalTrends presents the global evolution of deaths and
disease burden from chronic respiratory diseases attributable to air
pollution over the past three decades. Overall, the data show a
declining trend in both mortality and disability burden, although
the reduction is not uniform across all measures.

```{r}
# Total deaths worldwide by year:
global_deaths <- gbd_total %>%
  filter(
    measure == "Deaths",
    location == "Global",
    rei == "Air pollution",
    metric == "Rate",
    cause == "Chronic respiratory diseases",
    age == "All ages",
    sex == "Both"
  ) %>%
select(measure, year, val, upper, lower)

# Total YLLs (Years of Life Lost) worldwide by year:
global_YLLs <- gbd_total %>%
  filter(
    measure == "YLLs (Years of Life Lost)",
    location == "Global",
    rei == "Air pollution",
    metric == "Rate",
    cause == "Chronic respiratory diseases",
    age == "All ages",
    sex == "Both"
  ) %>%
  select(measure, year, val, upper, lower)

# Total YLDs (Years Lived with Disability) worldwide by year:
global_YLDs <- gbd_total %>%
  filter(
    measure == "YLDs (Years Lived with Disability)",
    location == "Global",
    rei == "Air pollution",
    metric == "Rate",
    cause == "Chronic respiratory diseases",
    age == "All ages",
    sex == "Both"
  ) %>%
  select(measure, year, val, upper, lower)

# Total DALYs worldwide by year:
global_DALYs <- gbd_total %>%
  filter(
    measure == "DALYs (Disability-Adjusted Life Years)",
    location == "Global",
    rei == "Air pollution",
    metric == "Rate",
    cause == "Chronic respiratory diseases",
    age == "All ages",
    sex == "Both"
  ) %>%
  select(measure, year, val, upper, lower)

# ----- Individual plots -----

# Deaths
p_deaths <- ggplot(global_deaths, aes(x = year, y = val)) +
  geom_ribbon(aes(ymin = lower, ymax = upper), fill = "#f4a582", alpha = 0.3) +
  geom_line(color = "#ca0020", size = 1.2) +
  geom_point(color = "#67001f", size = 2) +
  labs(title = "Deaths", x = "Year", y = "Deaths / 100k") +
  theme_minimal(base_size = 10) +
  theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5))

# DALYs
p_dalys <- ggplot(global_DALYs, aes(x = year, y = val)) +
  geom_ribbon(aes(ymin = lower, ymax = upper), fill = "#fee08b", alpha = 0.3) +
  geom_line(color = "#fdae61", size = 1.2) +
  geom_point(color = "#e08214", size = 2) +
  labs(title = "DALYs (Disability-Adjusted Life Years)", x = "Year", y = "DALYs / 100k") +
  theme_minimal(base_size = 10) +
  theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5))

# YLLs
p_ylls <- ggplot(global_YLLs, aes(x = year, y = val)) +
  geom_ribbon(aes(ymin = lower, ymax = upper), fill = "#91bfdb", alpha = 0.3) +
  geom_line(color = "#4575b4", size = 1.2) +
  geom_point(color = "#313695", size = 2) +
  labs(title = "YLLs (Years of Life Lost)", x = "Year", y = "YLLs / 100k") +
  theme_minimal(base_size = 10) +
  theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5))

# YLDs
p_ylds <- ggplot(global_YLDs, aes(x = year, y = val)) +
  geom_ribbon(aes(ymin = lower, ymax = upper), fill = "#c7e9c0", alpha = 0.4) +
  geom_line(color = "#238b45", size = 1.2) +
  geom_point(color = "#00441b", size = 2) +
  labs(title = "YLDs (Years Lived with Disability)", x = "Year", y = "YLDs / 100k") +
  theme_minimal(base_size = 10) +
  theme(plot.title = element_text(size = 14, face = "bold", hjust = 0.5))


# Combine and add main title + caption
combined_plot <- (p_deaths | p_dalys) /
  (p_ylls   | p_ylds) +
  plot_annotation(
    title = "Global Burden of Air Pollution on Chronic Respiratory Diseases (1990–2021)",
    caption = "Data source: Global Burden of Disease 2021",
    theme = theme(
      plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
      plot.caption = element_text(size = 8, face = "italic")
    )
  )

# Show the combined plot
combined_plot
```

The number of deaths per 100,000 population decreased from
approximately 30 in 1990 to around 25 in recent years, with a slight
increase observed toward the end of the period due to the atipic year of
the covid pandemic. A more pronounced decline is seen in DALYs,
which dropped from about 700 per 100,000 in 1990 to roughly 500 per
100,000 by 2021. This suggests a meaningful reduction in the overall
health impact of air pollution on respiratory diseases.

The decrease is largely driven by a reduction in YLLs, which fell
from around 700 to below 400 per 100,000, indicating fewer premature
deaths over time. In contrast, YLDs remained relatively stable
throughout the period, with minor fluctuations and a slight increase in
recent years. This pattern suggests that while fewer people are dying
prematurely from pollution-related CRDs, the burden of living with these
conditions has not improved significantly.

Together, these trends reflect progress in reducing the fatal impact of
air pollution on respiratory health globally, likely due to improvements
in air quality, healthcare access, and disease prevention. However, the
persistent levels of disability highlight the need for continued efforts
in long-term disease management and rehabilitation.

## Age and Gender

```{r}
# Filtrar apenas linhas com metric == "Rate" e measure == "Deaths"
gbd_filtered <- gbd_total %>% 
        filter(
                measure == "Deaths" & 
                location == "Global" & 
                sex %in% c("Male", "Female") &
                !age %in% c("All ages", "7-27 days", "Age-standardized") &
                cause == "All causes" & 
                rei == "Air pollution" & 
                metric == "Rate" & 
                year == "2021"
        )
# Fazer Barplot
gbd_filtered %>%
        ggplot(aes(x = age, y = val, fill = sex)) +  # Adicionado fill = sex para agrupamento
        geom_bar(
                stat = "identity", 
                width = 0.6,
                alpha = 0.5,
        ) +  # position_dodge para barras lado a lado
        labs(
                title = "Impact of Type of Air Pollution by Age and Gender (2021)",
                x = "Age", 
                y = "Deaths (rate per 100,000)", 
                fill = "Gender",
                caption = "Data Source: GBD 2021"
        ) +
        geral_theme
```

# Discussion

Our findings align closely with the study by Dhimal et al., which
emphasized the extensive impact of both ambient and household air
pollution on global health metrics, particularly mortality and
disability-adjusted life years (DALYs) from 1990 to 2019. Similar to our
analysis, Dhimal et al. reported how ambient and household pollution
disproportionately affect vulnerable groups—infants, elderly, women, and
those with pre-existing cardiorespiratory conditions—while also
highlighting regional disparities by socio-demographic index (SDI)
[@dhimal_impact_2021]. Our study corroborates these findings, revealing
comparable geographical and demographic patterns, and reinforcing the
need for targeted environmental health strategies in low-SDI regions.
Ostro et al.’s assessment of the GBD methodology for estimating the
burden of ambient air pollution in low- and middle-income countries
underscores critical methodological complexities
[@ostro_assessing_2018]. They argue that changes in exposure modeling,
such as refining PM$_{2.5}$ concentration estimates and adjusting
exposure–response curves, significantly alter burden estimates across
different geographical contexts. Our research applies similar
methodological refinements—employing updated exposure-response functions
and stratifying by pollutant type—and arrives at notably consistent
estimates of CRD burden, especially in countries with limited monitoring
infrastructure. This parallel strengthens confidence in our approach and
supports the WHO’s revised burden metrics. Finally, the recent Lancet
study by Bennitt et al. (2025) provides a comprehensive evaluation of
household air pollution (HAP) trends and burdens from 1990 to 2021,
reporting that in 2021 approximately 2.67 billion people (33.8% of the
global population) were exposed to HAP at mean PM$_{2.5}$ concentrations
of 84.2 µg/m³. They also estimate 111 million attributable DALYs,
constituting 3.9% of the global DALY total [@bennitt_global_2025]. Our
analysis produces similar exposure prevalence and burden figures,
reinforcing the enduring health impact of HAP despite gradual reductions
in percentage exposure since 1990. This concordance emphasizes the need
for continued interventions aimed at reducing solid fuel usage and
improving indoor air quality, particularly in rural, low-income
communities.

# Limitations

While this study provides valuable insights into the global impact of
air pollution on chronic respiratory diseases, several limitations must
be acknowledged. First, the GBD dataset relies on modeled estimates,
which may be affected by data availability and quality across countries,
particularly in low-income regions. Second, the attribution of disease
burden to specific pollutants is complex and may involve overlapping
exposures, making it difficult to isolate the effects of individual
pollutants. Additionally, the analysis does not account for potential
confounding factors such as smoking, occupational exposures, or
socioeconomic determinants that may influence respiratory health. The
use of aggregated data also limits the ability to explore
individual-level risk factors or causal relationships. Finally, while
the study spans multiple years, changes in data collection methods or
definitions over time may affect comparability. Future research should
aim to integrate more granular data and consider longitudinal designs to
better understand the dynamics of air pollution and respiratory disease
burden.

# Conclusions

In 2021, chronic respiratory diseases (CRDs) accounted for approximately
22.1% of all deaths and 29.4% of all years lived with disability (YLDs)
attributable to air pollution. Ambient particulate matter emerged as the
leading contributor to the global CRD burden, followed by household air
pollution, whose impact is inversely related to the Socio-demographic
Index (SDI) level. The burden of air pollution on CRDs is most
pronounced in low-middle SDI countries, with the exception of YLDs,
followed by low SDI regions. While the impact of ambient pollution is
increasing over time, the influence of household air pollution is
gradually declining. Geographically, the highest death rates due to air
pollution were observed in Oceania, South Asia, and Sub-Saharan Africa,
whereas the lowest rates occurred in North America, Europe, and
Australasia. Health system capacity also plays a critical role:
countries with limited or minimal health systems experience a
significantly higher burden of CRD due to air pollution. Although
progress has been made in reducing mortality, the chronic health impact
remains substantial — with a noticeable shift from mortality to
long-term disability and illness. Finally, the mortality rate from air
pollution-related CRDs is directly proportional to age and consistently
higher in men than in women, underscoring the need for targeted
interventions and gender-sensitive public health strategies

# References

::: {#refs}
:::

\newpage

# Annexes

## Search link and generated file

1990 + Global + SDI + Health System\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/4ea5715918446e5a6d9b154d62e0cc4a>
IHME-GBD_2021_DATA-4835a3dc-1.csv\
2000 + Global + SDI + Health System\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/64781d061f111ef4af5ad17974b6eb98>
IHME-GBD_2021_DATA-c56a3848-1.csv\
2010 + Global + SDI + Health System\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/88ae5e347d197231fa598e3dfc8e219a>
IHME-GBD_2021_DATA-1923af35-1.csv\
2020 + Global + SDI + Health System\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/2d070aac165f1d6a455d41df6c34e501>
IHME-GBD_2021_DATA-d14075a8-1.csv\
2021 + Global + SDI + Health System\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/3fad5e919cb9822381a5b56543978c2a>
IHME-GBD_2021_DATA-840155c6-1.csv\
1990 + All countries + Age (all + standardized) + Sex (Both)\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/8dcef8a43426d16927c72f4d2a96147c>
IHME-GBD_2021_DATA-7baf5a43-1.csv\
2000 + All countries + Age (all + standardized) + Sex (Both)\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/137d422bc7e27adb3442cd2a0c699368>
IHME-GBD_2021_DATA-db69c1e8-1.csv\
2010 + All countries + Age (all + standardized) + Sex (Both)\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/be61825c6c4ec111b07e9d9847613cd0>
IHME-GBD_2021_DATA-dcf93c30-1.csv\
2020 + All countries + Age (all + standardized) + Sex (Both)\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/972411dc3a931543fdecc15424db9019>
IHME-GBD_2021_DATA-03b79351-1.csv\
2021 + All countries + Age (all + standardized) + Sex (Both)\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/337e92e538d09c5d3d80640ee324032e>
IHME-GBD_2021_DATA-ce582a59-1.csv\
(1990,2000,2010,2020,2021) + GBD countries except costume + Age
standardized + Sex (Both)\
<https://vizhub.healthdata.org/gbd-results?params=gbd-api-2021-permalink/0afce2e9094f891f22453111c6986ffb>
IHME-GBD_2021_DATA-382c4db5-1.csv
